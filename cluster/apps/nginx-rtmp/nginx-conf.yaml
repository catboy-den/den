kind: ConfigMap
apiVersion: v1
metadata:
  name: nginx-rtmp-conf
data:
  nginxconf: |-
    rtmp {
      server {
        listen 1935; # this is the port, you may change it if necessary.
        chunk_size 4000; # a basic chunk_size for RTMP's uses.
        
        application live { # "live" may be changed to whatever you'd like, this will affect the URLs we use later, though.
          live on;
          
          allow publish 127.0.0.1 192.168.0.1/16; # this may include your entire network, you may be more or less exact with this. 
                                                  # if you don't care about potential griefing, use `all' in place of the IPs.
          deny publish all; # denied if none of the above apply.
          
          # -- HLS --
          hls on;
          hls_path /tmp/hls; # this is where all of HLS's files will be stored. 
                            # They are a running replacement so disk space will be minimal. 
                            # Adjust other HLS settings if necessary to level it out if it's a problem.
                            
                            
          hls_playlist_length 4s; # Thies 2 lines should help with latency
          hls_fragment 1s;        # The hls_fragment should match your keyframe interval in obs see screenshot in readme
          
          # optionally,
          #hls_continuous on;
          # Uncommenting will fix a minor issue if the stream ends prematurely.
          # However... this does have a side effect of using more disk space.
        }
      }
    }

    server {
      listen 80;

      # setting up any HTTP configuration you'd like is ok, the only important part is below.
      
      location /hls {
        # Serve HLS fragments
        types {
            application/vnd.apple.mpegurl m3u8;
            video/mp2t ts;
        }
        root /tmp;
        add_header Cache-Control no-cache;
      }
    }
