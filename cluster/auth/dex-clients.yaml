apiVersion: v1
kind: Namespace
metadata:
  name: dex
  labels:
    sealedSecret: github-oauth
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: dex-static-clients
  namespace: dex
  annotations:
    vault.security.banzaicloud.io/vault-addr: "https://vault.vault:8200"
    vault.security.banzaicloud.io/vault-role: "default"
    vault.security.banzaicloud.io/vault-tls-secret: vault-tls
data:
  staticClients: |-
    - id: weave-gitops
      redirectURIs:
      - 'https://weave.catboy.rest/oauth2/callback'
      name: 'Weave Gitops'
      secret: ${vault:secret/data/dex-staticClient-secret#secret}
---
apiVersion: v1
kind: Secret
metadata:
  name: dex-static-clients-secret
  namespace: dex
  annotations:
    vault.security.banzaicloud.io/vault-addr: "https://vault.vault:8200"
    vault.security.banzaicloud.io/vault-role: "default"
    vault.security.banzaicloud.io/vault-tls-secret: vault-tls
type: Opaque
data:
  staticClients: [{"id": "weave-gitops", "redirectURIs": ["https://weave.catboy.rest/oauth2/callback"], "name": "Weave Gitops", "secret": "${vault:secret/data/dex-staticClient-secret#secret}"}]
